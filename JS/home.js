// let musicData = {
//   played: [
//     { id: "1", title: "Endless Summer", artist: "Sarah Johnson", image: "../assets/images/img_2.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "2", title: "Midnight Dreams", artist: "Alex Turner", image: "../assets/images/img_3.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "3", title: "Neon Lights", artist: "Electro Beats", image: "../assets/images/img_4.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "4", title: "Mountain View", artist: "Nature Sounds", image: "../assets/images/img_5.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "5", title: "City Lights", artist: "Urban Rhythms", image: "../assets/images/img_6.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "6", title: "Ocean Waves", artist: "Coastal Sounds", image: "../assets/images/img_7.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "7", title: "Bloodlust", artist: "Ava Cornish & Brian Hill", image: "../assets/images/song1.jpg.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "8", title: "Time flies", artist: "Ava Cornish & Brian Hill", image: "../assets/images/song5.jpg.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "9", title: "Dark matters", artist: "Ava Cornish & Brian Hill", image: "../assets/images/song6.jpg.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "10", title: "Eye to eye", artist: "Ava Cornish & Brian Hill", image: "../assets/images/song1.jpg.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "11", title: "Cloud nine", artist: "Ava Cornish & Brian Hill", image: "../assets/images/song3.jpg.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "12", title: "Cobweb of lies", artist: "Ava Cornish & Brian Hill", image: "../assets/images/song5.jpg.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" }
//   ],
//   top15: [
//     { id: "1", title: "Summer Vibes", artist: "Beach Boys", image: "../assets/images/img_10.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "2", title: "Moonlit Nights", artist: "Luna Echo", image: "../assets/images/img_11.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "3", title: "Electric Pulse", artist: "DJ Spark", image: "../assets/images/img_12.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "4", title: "Golden Hour", artist: "Sunny Days", image: "../assets/images/img_13.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "5", title: "Echoes of Love", artist: "Heartstrings", image: "../assets/images/img_14.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "6", title: "City Dreams", artist: "Urban Echo", image: "../assets/images/img_15.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "7", title: "Starry Sky", artist: "Night Glow", image: "../assets/images/img_16.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "8", title: "Rhythm Flow", artist: "Beat Master", image: "../assets/images/img_17.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "9", title: "Ocean Breeze", artist: "Wave Riders", image: "../assets/images/img_18.png", mp3: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-5.mp3" },
//     { id: "10", title: "Sunset Glow", artist: "Horizon Band", image: "../assets/images/img_14.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "11", title: "Neon Dreams", artist: "Light Pulse", image: "../assets/images/img_17.png", mp3: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-7.mp3" },
//     { id: "12", title: "Wild Hearts", artist: "Free Spirits", image: "../assets/images/img_10.png", mp3: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-8.mp3" },
//     { id: "13", title: "Crystal Echo", artist: "Glass Notes", image: "../assets/images/img_16.png", mp3: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-9.mp3" },
//     { id: "14", title: "Frosty Nights", artist: "Winter Chill", image: "../assets/images/img_19.png", mp3: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-10.mp3" },
//     { id: "15", title: "Fire Within", artist: "Blaze Band", image: "../assets/images/img_15.png", mp3: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-11.mp3" }
//   ],
//   artist: [
//     { id: "1", title: "Endless Summer", artist: "Sarah Johnson", image: "../assets/images/img_2.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "2", title: "Midnight Dreams", artist: "Alex Turner", image: "../assets/images/img_3.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "3", title: "Neon Lights", artist: "Electro Beats", image: "../assets/images/img_4.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "4", title: "Mountain View", artist: "Nature Sounds", image: "../assets/images/img_5.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "5", title: "City Lights", artist: "Urban Rhythms", image: "../assets/images/img_6.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "6", title: "Ocean Waves", artist: "Coastal Sounds", image: "../assets/images/img_7.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "7", title: "Bloodlust", artist: "Ava Cornish & Brian Hill", image: "../assets/images/song1.jpg.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "8", title: "Time flies", artist: "Ava Cornish & Brian Hill", image: "../assets/images/song5.jpg.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "9", title: "Dark matters", artist: "Ava Cornish & Brian Hill", image: "../assets/images/song6.jpg.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "10", title: "Eye to eye", artist: "Ava Cornish & Brian Hill", image: "../assets/images/song1.jpg.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "11", title: "Cloud nine", artist: "Ava Cornish & Brian Hill", image: "../assets/images/song3.jpg.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "12", title: "Cobweb of lies", artist: "Ava Cornish & Brian Hill", image: "../assets/images/song5.jpg.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" }
//   ],
//   releases: [
//     { title: "Dark Alley Acoustic", artist: "Ava Cornish", image: "../assets/images/img_14.png", duration: "5:10", mp3: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-12.mp3" },
//     { title: "Dreamy Nights", artist: "Luna Echo", image: "../assets/images/img_16.png", duration: "4:30", mp3: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-13.mp3" },
//     { title: "Electric Vibes", artist: "DJ Spark", image: "../assets/images/img_11.png", duration: "3:45", mp3: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-14.mp3" },
//     { title: "Golden Sunset", artist: "Sunny Days", image: "../assets/images/img_15.png", duration: "4:15", mp3: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-15.mp3" }
//   ],
//   albums: [
//     { id: "1", title: "Endless Summer", artist: "Sarah Johnson", image: "../assets/images/img_2.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "2", title: "Midnight Dreams", artist: "Alex Turner", image: "../assets/images/img_3.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "3", title: "Neon Lights", artist: "Electro Beats", image: "../assets/images/img_4.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "4", title: "Mountain View", artist: "Nature Sounds", image: "../assets/images/img_5.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "5", title: "City Lights", artist: "Urban Rhythms", image: "../assets/images/img_6.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "6", title: "Ocean Waves", artist: "Coastal Sounds", image: "../assets/images/img_7.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "7", title: "Bloodlust", artist: "Ava Cornish & Brian Hill", image: "../assets/images/song1.jpg.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "8", title: "Time flies", artist: "Ava Cornish & Brian Hill", image: "../assets/images/song5.jpg.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "9", title: "Dark matters", artist: "Ava Cornish & Brian Hill", image: "../assets/images/song6.jpg.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "10", title: "Eye to eye", artist: "Ava Cornish & Brian Hill", image: "../assets/images/song1.jpg.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "11", title: "Cloud nine", artist: "Ava Cornish & Brian Hill", image: "../assets/images/song3.jpg.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" },
//     { id: "12", title: "Cobweb of lies", artist: "Ava Cornish & Brian Hill", image: "../assets/images/song5.jpg.png", mp3: "https://samplesongs.netlify.app/Death%20Bed.mp3" }
//   ]
// };
let musicData = JSON.parse(localStorage.getItem("homepage")) ||  [];
// Danh sách tài khoản tĩnh
let accounts = [
  { email: "admin@example.com", password: "Admin@123", fullName: "Admin User", role: "Admin" }
];
let currentUser = null;

document.addEventListener("DOMContentLoaded", () => {
  // Lấy các phần tử HTML
  const searchInput = document.querySelector(".search-input");
  const searchBtn = document.querySelector(".search-btn");
  const clearBtn = document.querySelector(".clear-btn");
  const searchMessage = document.querySelector(".search-message");
  const recentlyPlayedGrid = document.querySelector(".recently-played .album-grid");
  const chartsGrid = document.querySelector(".charts-section .charts-grid");
  const artistsGrid = document.querySelector(".featured-artists .album-grid");
  const albumsGrid = document.querySelector(".featured-albums .album-grid");
  const sidebar = document.querySelector(".sidebar");
  const chevronBtn = document.querySelector(".sidebar-chevorn a");
  const mainContent = document.querySelector(".container");
  const audioPlayer = document.getElementById("audio-player");
  const playBtn = document.querySelector(".play-btn");
  const skipBackwardBtn = document.querySelector(".skip-backward-btn");
  const skipForwardBtn = document.querySelector(".skip-forward-btn");
  const muteBtn = document.querySelector(".mute-btn");
  const playerImg = document.querySelector(".player-album-img img");
  const playerTitle = document.querySelector(".player-song-info h6");
  const playerArtist = document.querySelector(".player-song-info p");
  const loginBtn = document.querySelector(".login-btn");
  const registerBtn = document.querySelector(".register-btn");
  const modalLogin = document.querySelector(".modalLogin");
  const loginForm = document.querySelector(".formLogin");
  const modalRegister = document.querySelector(".modalRegister");
  const registerForm = document.querySelector(".formRegister");
  const registerLink = document.querySelector(".formLogin .register-link");
  const loginLink = document.querySelector(".formRegister .login-link");

  // Biến trạng thái
  let isPlaying = false;
  let isMuted = false;
  let currentSongIndex = -1;
  let currentPlaylist = musicData.albums;

  // Hiển thị danh sách bài hát
  function showSongs() {
    if (recentlyPlayedGrid) {
      recentlyPlayedGrid.innerHTML = musicData.played.map((song, index) => `
        <div class="album-item" data-index="${index}">
          <img src="${song.image}" alt="Album">
          <div class="album-info">
            <div class="album-title">${song.title}</div>
            <div class="album-artist">${song.artist}</div>
          </div>
        </div>
      `).join("");
    }
    if (artistsGrid) {
      artistsGrid.innerHTML = musicData.artist.map((song, index) => `
        <div class="album-item" data-index="${index}">
          <img src="${song.image}" alt="Artist">
          <div class="album-info">
            <div class="album-title">${song.title}</div>
            <div class="album-artist">${song.artist}</div>
          </div>
        </div>
      `).join("");
    }
    if (albumsGrid) {
      albumsGrid.innerHTML = musicData.albums.map((song, index) => `
        <div class="album-item" data-index="${index}">
          <img src="${song.image}" alt="Album">
          <div class="album-info">
            <div class="album-title">${song.title}</div>
            <div class="album-artist">${song.artist}</div>
          </div>
        </div>
      `).join("");
    }
    if (chartsGrid) {
      chartsGrid.innerHTML = musicData.top15.map((song, index) => `
        <div class="chart-item" data-index="${index}">
          <div class="chart-number">${(index + 1).toString().padStart(2, "0")}</div>
          <img src="${song.image}" alt="Song">
          <div class="chart-info">
            <div class="chart-title">${song.title}</div>
            <div class="chart-artist">${song.artist}</div>
          </div>
          <button class="chart-play-btn"><i class="fas fa-play"></i></button>
        </div>
      `).join("");
    }
  }

  // Tìm kiếm bài hát
  if (searchInput && searchBtn && clearBtn && searchMessage) {
    searchBtn.addEventListener("click", () => {
      const query = searchInput.value.toLowerCase().trim();
      const filteredPlayed = musicData.played.filter(song => song.title.toLowerCase().includes(query));
      const filteredArtists = musicData.artist.filter(song => song.title.toLowerCase().includes(query));
      const filteredAlbums = musicData.albums.filter(song => song.title.toLowerCase().includes(query));
      const filteredCharts = musicData.top15.filter(song => song.title.toLowerCase().includes(query));

      if (recentlyPlayedGrid) {
        recentlyPlayedGrid.innerHTML = filteredPlayed.map((song, index) => `
          <div class="album-item" data-index="${index}">
            <img src="${song.image}" alt="Album">
            <div class="album-info">
              <div class="album-title">${song.title}</div>
              <div class="album-artist">${song.artist}</div>
            </div>
          </div>
        `).join("");
      }
      if (artistsGrid) {
        artistsGrid.innerHTML = filteredArtists.map((song, index) => `
          <div class="album-item" data-index="${index}">
            <img src="${song.image}" alt="Artist">
            <div class="album-info">
              <div class="album-title">${song.title}</div>
              <div class="album-artist">${song.artist}</div>
            </div>
          </div>
        `).join("");
      }
      if (albumsGrid) {
        albumsGrid.innerHTML = filteredAlbums.map((song, index) => `
          <div class="album-item" data-index="${index}">
            <img src="${song.image}" alt="Album">
            <div class="album-info">
              <div class="album-title">${song.title}</div>
              <div class="album-artist">${song.artist}</div>
            </div>
          </div>
        `).join("");
      }
      if (chartsGrid) {
        chartsGrid.innerHTML = filteredCharts.map((song, index) => `
          <div class="chart-item" data-index="${index}">
            <div class="chart-number">${(index + 1).toString().padStart(2, "0")}</div>
            <img src="${song.image}" alt="Song">
            <div class="chart-info">
              <div class="chart-title">${song.title}</div>
              <div class="chart-artist">${song.artist}</div>
            </div>
            <button class="chart-play-btn"><i class="fas fa-play"></i></button>
          </div>
        `).join("");
      }

      searchMessage.style.display = (filteredPlayed.length === 0 && filteredCharts.length === 0 && query) ? "block" : "none";
      searchMessage.textContent = query && filteredPlayed.length === 0 && filteredCharts.length === 0 ? "Không tìm thấy bài hát." : "";
    });

    clearBtn.addEventListener("click", () => {
      searchInput.value = "";
      clearBtn.style.display = "none";
      searchMessage.style.display = "none";
      showSongs();
    });

    searchInput.addEventListener("input", () => {
      clearBtn.style.display = searchInput.value ? "block" : "none";
    });
  }

  // Phát bài hát
  function playSong(song, index, playlist) {
    if (!song || !song.mp3) {
      Swal.fire("Lỗi!", "Bài hát không hợp lệ.", "error");
      return;
    }
    currentSongIndex = index;
    currentPlaylist = playlist;
    playerImg.src = song.image;
    playerTitle.textContent = song.title;
    playerArtist.textContent = song.artist;
    audioPlayer.src = song.mp3;
    audioPlayer.play();
    isPlaying = true;
    playBtn.querySelector("i").classList.replace("bi-play-fill", "bi-pause-fill");
  }

  // Nhấn nút phát/tạm dừng
  if (playBtn) {
    playBtn.addEventListener("click", () => {
      if (isPlaying) {
        audioPlayer.pause();
        isPlaying = false;
        playBtn.querySelector("i").classList.replace("bi-pause-fill", "bi-play-fill");
      } else {
        audioPlayer.play();
        isPlaying = true;
        playBtn.querySelector("i").classList.replace("bi-play-fill", "bi-pause-fill");
      }
    });
  }

  // Nhấn nút bài trước
  if (skipBackwardBtn) {
    skipBackwardBtn.addEventListener("click", () => {
      if (currentSongIndex > 0) {
        playSong(currentPlaylist[currentSongIndex - 1], currentSongIndex - 1, currentPlaylist);
      }
    });
  }

  // Nhấn nút bài sau
  if (skipForwardBtn) {
    skipForwardBtn.addEventListener("click", () => {
      if (currentSongIndex < currentPlaylist.length - 1) {
        playSong(currentPlaylist[currentSongIndex + 1], currentSongIndex + 1, currentPlaylist);
      }
    });
  }

  // Nhấn nút tắt âm
  if (muteBtn) {
    muteBtn.addEventListener("click", () => {
      isMuted = !isMuted;
      audioPlayer.muted = isMuted;
      muteBtn.querySelector("i").classList.toggle("bi-volume-up-fill", !isMuted);
      muteBtn.querySelector("i").classList.toggle("bi-volume-mute-fill", isMuted);
    });
  }

  // Nhấn vào bài hát
  if (recentlyPlayedGrid) {
    recentlyPlayedGrid.addEventListener("click", (e) => {
      const item = e.target.closest(".album-item");
      if (item) {
        const index = parseInt(item.dataset.index);
        playSong(musicData.played[index], index, musicData.played);
      }
    });
  }
  if (artistsGrid) {
    artistsGrid.addEventListener("click", (e) => {
      const item = e.target.closest(".album-item");
      if (item) {
        const index = parseInt(item.dataset.index);
        playSong(musicData.artist[index], index, musicData.artist);
      }
    });
  }
  if (albumsGrid) {
    albumsGrid.addEventListener("click", (e) => {
      const item = e.target.closest(".album-item");
      if (item) {
        const index = parseInt(item.dataset.index);
        playSong(musicData.albums[index], index, musicData.albums);
      }
    });
  }
  if (chartsGrid) {
    chartsGrid.addEventListener("click", (e) => {
      const item = e.target.closest(".chart-item");
      if (item) {
        const index = parseInt(item.dataset.index);
        playSong(musicData.top15[index], index, musicData.top15);
      }
    });
  }

// Chức năng thanh bên

let isSidebarExpanded = false;

  if (chevronBtn) {
    chevronBtn.addEventListener("click", () => {
      isSidebarExpanded = !isSidebarExpanded;
      if (isSidebarExpanded) {
        sidebar.classList.add("expanded");
        mainContent.classList.add("expanded");
        header.classList.add("expanded");
        chevronBtn
          .querySelector("i")
          .classList.replace("fa-chevron-right", "fa-chevron-left");
      } else {
        sidebar.classList.remove("expanded");
        mainContent.classList.remove("expanded");
        header.classList.remove("expanded");
        chevronBtn
          .querySelector("i")
          .classList.replace("fa-chevron-left", "fa-chevron-right");
      }
    });
  }

  const links = document.querySelectorAll(".sidebar a");
  const currentPage = window.location.pathname.split("/").pop();
  links.forEach((link) => {
    const linkPage = link.getAttribute("href");
    if (linkPage === currentPage) {
      link.classList.add("active");
    }
  });
  // Đăng nhập/đăng xuất
  function updateLoginButton() {
    if (currentUser) {
      loginBtn.textContent = "Đăng xuất";
      loginBtn.classList.remove("login-btn");
      loginBtn.classList.add("logout-btn");
      loginBtn.onclick = () => {
        currentUser = null;
        loginBtn.classList.remove("logout-btn");
        loginBtn.classList.add("login-btn");
        updateLoginButton();
        showSongs();
        Swal.fire("Thành công!", "Đã đăng xuất.", "success");
      };
      registerBtn.style.display = "none";
      const welcome = document.createElement("span");
      welcome.className = "welcome-text";
      welcome.textContent = `Chào, ${currentUser.fullName}`;
      loginBtn.parentNode.insertBefore(welcome, loginBtn);
    } else {
      loginBtn.textContent = "Đăng nhập";
      loginBtn.classList.remove("logout-btn");
      loginBtn.classList.add("login-btn");
      loginBtn.onclick = () => {
        modalLogin.style.display = "block";
      };
      registerBtn.style.display = "inline-block";
      const welcome = loginBtn.parentNode.querySelector(".welcome-text");
      if (welcome) welcome.remove();
    }
  }

  // Xử lý modal đăng nhập
  if (modalLogin && loginForm) {
    loginForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value.trim();

      // Validate form fields
      if (!email || !password) {
        Swal.fire({
          icon: "error",
          title: "Lỗi!",
          text: "Vui lòng điền đầy đủ thông tin đăng nhập.",
        });
        return;
      }

      const user = accounts.find(acc => acc.email === email && acc.password === password);
      if (user) {
        currentUser = user;
        modalLogin.style.display = "none";
        loginForm.reset();
        updateLoginButton();
        if (user.role === "Admin") window.location.href = "Admin-page.html";
        Swal.fire("Thành công!", "Đăng nhập thành công.", "success");
      } else {
        Swal.fire("Lỗi!", "Email hoặc mật khẩu sai.", "error");
      }
    });
    modalLogin.addEventListener("click", (e) => {
      if (e.target === modalLogin) modalLogin.style.display = "none";
    });
  }

  // Xử lý modal đăng ký
  if (modalRegister && registerForm) {
    registerBtn.onclick = () => modalRegister.style.display = "block";
    registerForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const name = document.getElementById("name").value.trim();
      const email = document.getElementById("email1").value.trim();
      const password = document.getElementById("password1").value.trim();
      const password2 = document.getElementById("password2").value.trim();

      // Validate form fields
      if (!name || !email || !password || !password2) {
        Swal.fire({
          icon: "error",
          title: "Lỗi!",
          text: "Vui lòng điền đầy đủ thông tin đăng ký.",
        });
        return;
      }

      if (password !== password2) {
        Swal.fire("Lỗi!", "Mật khẩu không khớp.", "error");
        return;
      }

      if (accounts.some(acc => acc.email === email)) {
        Swal.fire("Lỗi!", "Email đã tồn tại.", "error");
        return;
      }

      const newUser = { email, password, fullName: name, role: "User" };
      accounts.push(newUser);
      currentUser = newUser;
      modalRegister.style.display = "none";
      registerForm.reset();
      updateLoginButton();
      Swal.fire("Thành công!", "Đăng ký thành công.", "success");
    });
    modalRegister.addEventListener("click", (e) => {
      if (e.target === modalRegister) modalRegister.style.display = "none";
    });
  }

  // Chuyển giữa đăng nhập và đăng ký
  if (registerLink) {
    registerLink.addEventListener("click", (e) => {
      e.preventDefault();
      modalLogin.style.display = "none";
      modalRegister.style.display = "block";
    });
  }
  if (loginLink) {
    loginLink.addEventListener("click", (e) => {
      e.preventDefault();
      modalRegister.style.display = "none";
      modalLogin.style.display = "block";
    });
  }

  // Carousel cho các section
  function setupCarousel(section) {
    const grid = document.querySelector(`.${section} .album-grid`);
    const nextBtn = document.querySelector(`.${section} .carousel-controls button:last-child`);
    const prevBtn = document.querySelector(`.${section} .carousel-controls button:first-child`);
    if (grid && nextBtn && prevBtn) {
      let index = 0;
      nextBtn.addEventListener("click", () => {
        if (index < grid.children.length - 3) {
          index++;
          grid.style.transform = `translateX(-${index * 33.33}%)`;
        }
      });
      prevBtn.addEventListener("click", () => {
        if (index > 0) {
          index--;
          grid.style.transform = `translateX(-${index * 33.33}%)`;
        }
      });
    }
  }
  setupCarousel("recently-played");
  setupCarousel("featured-artists");
  setupCarousel("featured-albums");

  // Khởi tạo
  showSongs();
  updateLoginButton();
});