let data = {
  "data": [
    {
      "Featured_Albums": [
        {
          "id": "1",
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Bloodlust",
          "img": "/assets/album1.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Death%20Bed.mp3"
        },
        {
          "id": "2",
          "name": "Ava Cornish & Brian Hill",
          "name_music": "Time flies",
          "img": "/assets/album2.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Bad%20Liar.mp3"
        },
        {
          "id": "3",
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Dark matters",
          "img": "/assets/album3.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Faded.mp3"
        },
        {
          "id": "4",
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Eye to eye",
          "img": "/assets/album4.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Hate%20Me.mp3"
        },
        {
          "id": "5",
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Cloud nine",
          "img": "/assets/album5.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Solo.mp3"
        },
        {
          "id": "6",
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Cobweb of lies",
          "img": "/assets/album6.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Without%20Me.mp3"
        },
        {
          "id": "7",
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Endless Things",
          "img": "/assets/artist1.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Death%20Bed.mp3"
        },
        {
          "id": "8",
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Desired Games",
          "img": "/assets/artist2.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Death%20Bed.mp3"
        }
      ]
    },
    {
      "Trending_Albums": [
        {
          "id": "1",
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Dream Your",
          "img": "/assets/artist13.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Bad%20Liar.mp3"
        },
        {
          "id": "2",
          "name": "Ava Cornish & Brian Hill",
          "name_music": "Until I Met You",
          "img": "/assets/artist12.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Faded.mp3"
        },
        {
          "id": "3",
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Gimme Some Courage",
          "img": "/assets/artist11.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Hate%20Me.mp3"
        },
        {
          "id": "4",
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Dark Alley Acoustic",
          "img": "/assets/artist10.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Hate%20Me.mp3"
        },
        {
          "id": "5",
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Walking Promises",
          "img": "/assets/artist9.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Death%20Bed.mp3"
        },
        {
          "id": "6",
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Desired Games",
          "img": "/assets/artist8.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Death%20Bed.mp3"
        },
        {
          "id": "7",
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Endless Things",
          "img": "/assets/artist7.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Solo.mp3"
        },
        {
          "id": "8",
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Desired Games",
          "img": "/assets/artist6.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Hate%20Me.mp3"
        }
      ]
    },
    {
      "top_15_albums": [
        {
          "id": "1",
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Dream Your",
          "img": "/assets/1.png",
          "mp3": "https://samplesongs.netlify.app/Bad%20Liar.mp3"
        },
        {
          "id": "2",
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Until I Met You",
          "img": "/assets/2.png",
          "mp3": "https://samplesongs.netlify.app/Solo.mp3"
        },
        {
          "id": "3",
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Gimme Some",
          "img": "/assets/3.png",
          "mp3": "https://samplesongs.netlify.app/Hate%20Me.mp3"
        },
        {
          "id": "4",
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Dark Alley Acoustic",
          "img": "/assets/4.png",
          "mp3": "https://samplesongs.netlify.app/Without%20Me.mp3"
        },
        {
          "id": "5",
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Walking Promises",
          "img": "/assets/5.png",
          "mp3": "https://samplesongs.netlify.app/Solo.mp3"
        },
        {
          "id": "6",
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Desired Games",
          "img": "/assets/6.png",
          "mp3": "https://samplesongs.netlify.app/Faded.mp3"
        },
        {
          "id": "7",
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Endless Things",
          "img": "/assets/7.png",
          "mp3": "https://samplesongs.netlify.app/Solo.mp3"
        },
        {
          "id": "8",
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Desired Games",
          "img": "/assets/8.png",
          "mp3": "https://samplesongs.netlify.app/Solo.mp3"
        },
        {
          "id": "9",
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Desired Games",
          "img": "/assets/9.png",
          "mp3": "https://samplesongs.netlify.app/Solo.mp3"
        },
        {
          "id": "10",
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Desired Games",
          "img": "/assets/10.png",
          "mp3": "https://samplesongs.netlify.app/Solo.mp3"
        },
        {
          "id": "11",
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Desired Games",
          "img": "/assets/11.png",
          "mp3": "https://samplesongs.netlify.app/Solo.mp3"
        },
        {
          "id": "12",
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Desired Games",
          "img": "/assets/12.png",
          "mp3": "https://samplesongs.netlify.app/Solo.mp3"
        },
        {
          "id": "13",
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Desired Games",
          "img": "/assets/13.png",
          "mp3": "https://samplesongs.netlify.app/Solo.mp3"
        },
        {
          "id": "14",
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Desired Games",
          "img": "/assets/14.png",
          "mp3": "https://samplesongs.netlify.app/Solo.mp3"
        },
        {
          "id": "15",
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Desired Games",
          "img": "/assets/15.png",
          "mp3": "https://samplesongs.netlify.app/Solo.mp3"
        }
      ]
    },
    {
      "Albums_By_Artists": [
        {
          "id": "1",
          "name": "Ava Cornish",
          "name_music": "Best Of Ava Cornish",
          "img": "/assets/artist1.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Solo.mp3"
        },
        {
          "id": "2",
          "name": "Until I Met You",
          "name_music": "Best Of Ava Cornish",
          "img": "/assets/artist2.jpg.png",
          "mp3": "/assets/2.mp3"
        },
        {
          "id": "3",
          "name": "Gimme Some Courage",
          "name_music": "Best Of Ava Cornish",
          "img": "/assets/artist3.jpg.png",
          "mp3": "/assets/3.mp3"
        },
        {
          "id": "4",
          "name": "Dark Alley Acoustic",
          "name_music": "Best Of Ava Cornish",
          "img": "/assets/artist4.jpg.png",
          "mp3": "/assets/4.mp3"
        },
        {
          "id": "5",
          "name": "Walking Promises",
          "name_music": "Best Of Ava Cornish",
          "img": "/assets/artist5.jpg.png",
          "mp3": "/assets/5.mp3"
        },
        {
          "id": "6",
          "name": "Desired Games",
          "name_music": "Best Of Ava Cornish",
          "img": "/assets/artist6.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Solo.mp3"
        },
        {
          "id": "7",
          "name": "Endless Things",
          "name_music": "Best Of Ava Cornish",
          "img": "/assets/artist7.jpg.png",
          "mp3": "/assets/2.mp3"
        },
        {
          "id": "8",
          "name": "Desired Games",
          "name_music": "Best Of Ava Cornish",
          "img": "/assets/artist8.jpg.png",
          "mp3": "/assets/3.mp3"
        }
      ]
    },
    {
      "New_Releases": [
        {
          "id": "1",
          "name": "The Testers",
          "name_music": "Fresh Beats",
          "img": "/assets/artist6.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Death%20Bed.mp3"
        },
        {
          "id": "2",
          "name": "Synthwave Masters",
          "name_music": "Neon Nights",
          "img": "/assets/artist1.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Bad%20Liar.mp3"
        },
        {
          "id": "3",
          "name": "Indie Rockers",
          "name_music": "Garage Echoes",
          "img": "/assets/artist2.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Faded.mp3"
        },
        {
          "id": "4",
          "name": "Chillhop Cafe",
          "name_music": "Lo-Fi Mornings",
          "img": "/assets/artist4.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Hate%20Me.mp3"
        }
      ]
    }
  ]
}

document.addEventListener("DOMContentLoaded", function () {
  window.playAudio       = playAudio;
  window.startstopaudio  = startstopaudio;
  window.nextAudio       = nextAudio;
  window.prevAudio       = prevAudio;
  // Initialize accounts and create default admin if none exists
  let accounts = JSON.parse(localStorage.getItem("accounts")) || [];
  const hasAdmin = accounts.some((account) => account.role === "Admin");
  if (!hasAdmin) {
    const defaultAdmin = {
      accountId: "TK000001",
      fullName: "Admin User",
      email: "admin@example.com",
      password: "Admin@123",
      dob: "01/01/1990",
      phone: "0123456789",
      hometown: "Hà Nội",
      role: "Admin",
    };
    accounts.push(defaultAdmin);
    localStorage.setItem("accounts", JSON.stringify(accounts));
  }

  let featuredContainer = document.getElementById("featured-albums");
  let trendingContainer = document.getElementById("trending-albums");
  let top15Container = document.getElementById("top15_albums");
  let albumsByArtistsContainer = document.getElementById("Artists-albums");
  let newReleasesContainer = document.getElementById("trending");
  let newReleasesData = data.data[4].New_Releases;

  let featuredAlbums = data.data[0].Featured_Albums;
  let trendingAlbums = data.data[1].Trending_Albums;
  let top15Albums = data.data[2].top_15_albums;
  let albumsByArtists = data.data[3].Albums_By_Artists;

  let featuredRef = { value: 0 };
  let trendingRef = { value: 0 };
  let artistsRef = { value: 0 };

  function renderAlbums(container, albums, ref) {
    let index = ref.value;
    let visible = albums.slice(index, index + 6);

    let itemClass = 'Featured-item';
    if (container.classList.contains('trending-albums')) itemClass = 'Trending-item';
    else if (container.id === 'Artists-albums') itemClass = 'Artists-item';

    container.innerHTML = `
        <button id="${container.id}-prev" class="btn btn-sm btn-outline-secondary me-1">
          <i class="bi bi-chevron-left"></i>
        </button>
        ${visible.map(album => `
          <div class="${itemClass}" onclick="playAudio('${album.mp3}', '${album.name_music.replace(/'/g, "\\'")}', '${album.name.replace(/'/g, "\\'")}', '${album.img}','${album.id}','${itemClass}')">
            <div class="mb-3"><img src="${album.img}" alt=""></div>
            <div><h6>${album.name_music}</h6></div>
            <div><span>${album.name}</span></div>
          </div>
        `).join('')}
        <button id="${container.id}-next" class="btn btn-sm btn-outline-secondary ms-1">
          <i class="bi bi-chevron-right"></i>
        </button>
      `;
  }

  function bindNav(container, albums, ref) {
    let prevBtn = document.getElementById(`${container.id}-prev`);
    let nextBtn = document.getElementById(`${container.id}-next`);

    prevBtn.onclick = () => {
      if (ref.value > 0) {
        ref.value--;
        renderAlbums(container, albums, ref);
        bindNav(container, albums, ref);
      }
    };
    nextBtn.onclick = () => {
      if (ref.value < albums.length - 6) {
        ref.value++;
        renderAlbums(container, albums, ref);
        bindNav(container, albums, ref);
      }
    };
  }

  renderAlbums(featuredContainer, featuredAlbums, featuredRef);
  bindNav(featuredContainer, featuredAlbums, featuredRef);

  renderAlbums(trendingContainer, trendingAlbums, trendingRef);
  bindNav(trendingContainer, trendingAlbums, trendingRef);

  renderAlbums(albumsByArtistsContainer, albumsByArtists, artistsRef);
  bindNav(albumsByArtistsContainer, albumsByArtists, artistsRef);
  renderNewReleases(newReleasesContainer, newReleasesData);

  let top15HTML = "";
  for (let i = 0; i < 3; i++) {
    top15HTML += '<div class="me-3">';
    for (let j = 0; j < 5; j++) {
      let idx = i * 5 + j;
      let album = top15Albums[idx];
      top15HTML += `
          <div class="d-flex align-items-center top-item" style="cursor: pointer;" onclick="playAudio('${album.mp3}', '${album.name_music.replace(/'/g, "\\'")}', '${album.name.replace(/'/g, "\\'")}', '${album.img}','${album.id}','top-item')">
            <div><h1>${(idx + 1).toString().padStart(2, '0')}</h1></div>
            <div class="divimg mx-3"><img class="small-img" src="${album.img}" alt=""></div>
            <div>
              <p style="margin-bottom: 0px;" class="text-top">${album.name_music}</p>
              <p class="text-top2">${album.name}</p>
            </div>
            <div class="ms-5 me-3">5:10</div>
            <div><i class="bi bi-three-dots"></i></div>
          </div>
          <hr>
        `;
    }
    top15HTML += '</div>';
  }
  top15Container.innerHTML = top15HTML;

  function renderNewReleases(container, releases) {
    let rowsHtml = '';
    for (let i = 0; i < releases.length; i += 4) {
      rowsHtml += '<div class="trendingRow">';
      let rowItems = releases.slice(i, i + 4);
      rowsHtml += rowItems.map(release => `
              <div class="trendingItem" style="cursor: pointer;" onclick="playAudio('${release.mp3}', '${release.name_music.replace(/'/g, "\\'")}', '${release.name.replace(/'/g, "\\'")}', '${release.img}','${release.id}','trendingItem')">
                  <img class="small-img" src="${release.img}" alt="${release.name_music}">
                  <div class="trackInfo">
                      <div class="songTitle">${release.name_music}</div>
                      <div class="artistName">${release.name}</div>
                  </div>
                  <div class="songDuration">5:10</div> 
                  </div>
          `).join('');
      rowsHtml += '</div>';
    }
    container.innerHTML = rowsHtml;
  }

  let searchInput = document.getElementById('search-input');
  let searchButton = document.getElementById('search-btn');

  function handleSearch() {
    let searchTerm = searchInput.value.toLowerCase().trim();
    let filteredFeatured = featuredAlbums.filter(album =>
      album.name_music.toLowerCase().includes(searchTerm) ||
      album.name.toLowerCase().includes(searchTerm)
    );
    featuredRef.value = 0;
    renderAlbums(featuredContainer, filteredFeatured, featuredRef);
    bindNav(featuredContainer, filteredFeatured, featuredRef);

    let filteredTrending = trendingAlbums.filter(album =>
      album.name_music.toLowerCase().includes(searchTerm) ||
      album.name.toLowerCase().includes(searchTerm)
    );
    trendingRef.value = 0;
    renderAlbums(trendingContainer, filteredTrending, trendingRef);
    bindNav(trendingContainer, filteredTrending, trendingRef);

    let filteredArtists = albumsByArtists.filter(album =>
      album.name_music.toLowerCase().includes(searchTerm) ||
      album.name.toLowerCase().includes(searchTerm)
    );
    artistsRef.value = 0;
    renderAlbums(albumsByArtistsContainer, filteredArtists, artistsRef);
    bindNav(albumsByArtistsContainer, filteredArtists, artistsRef);
  }

  searchButton.addEventListener('click', handleSearch);

  // Authentication Functions
  function updateAuthButtons() {
    const currentUser = JSON.parse(localStorage.getItem("currentUser"));
    let loginBtn = document.querySelector(".login-btn");
    const registerBtn = document.querySelector(".register-btn");

    if (currentUser) {
      if (registerBtn) registerBtn.style.display = "none";
      if (loginBtn) {
        loginBtn.textContent = "Logout";
        loginBtn.classList.remove("login-btn");
        loginBtn.classList.add("logout-btn");
        const newLoginBtn = loginBtn.cloneNode(true);
        loginBtn.parentNode.replaceChild(newLoginBtn, loginBtn);
        newLoginBtn.addEventListener("click", () => {
          Swal.fire({
            title: "Are you sure?",
            text: "You will be logged out of your account.",
            icon: "warning",
            showCancelButton: true,
            confirmButtonText: "Yes, log out",
            cancelButtonText: "Cancel",
          }).then((result) => {
            if (result.isConfirmed) {
              localStorage.removeItem("currentUser");
              Swal.fire("Logged out!", "You have been successfully logged out.", "success");
              updateAuthButtons();
              handleSearch(); // Reset content
            }
          });
        });
      }
      const welcomeMessage = document.createElement("span");
      welcomeMessage.className = "me-2";
      welcomeMessage.textContent = `Welcome, ${currentUser.fullName}`;
      const authContainer = document.querySelector("header .d-flex.align-items-center > div:last-child");
      if (authContainer && !authContainer.querySelector("span.me-2")) {
        authContainer.insertBefore(welcomeMessage, authContainer.firstChild);
      }
    } else {
      if (registerBtn) registerBtn.style.display = "inline-block";
      loginBtn = document.querySelector(".logout-btn") || document.querySelector(".login-btn");
      if (loginBtn && loginBtn.classList.contains("logout-btn")) {
        loginBtn.textContent = "Login";
        loginBtn.classList.remove("logout-btn");
        loginBtn.classList.add("login-btn");
        const newLoginBtn = loginBtn.cloneNode(true);
        loginBtn.parentNode.replaceChild(newLoginBtn, loginBtn);
        loginBtn = newLoginBtn;
      }
      if (loginBtn) {
        loginBtn.addEventListener("click", () => {
          const modalLogin = document.querySelector(".modalLogin");
          if (modalLogin) {
            modalLogin.classList.add("show");
            modalLogin.style.display = "flex";
          } else {
            Swal.fire("Error!", "Login modal not found.", "error");
          }
        });
      }
      const welcomeMessage = document.querySelector("header .d-flex.align-items-center span.me-2");
      if (welcomeMessage) welcomeMessage.remove();
    }

    const newRegisterBtn = document.querySelector(".register-btn");
    if (newRegisterBtn) {
      newRegisterBtn.addEventListener("click", () => {
        const modalRegister = document.querySelector(".modalRegister");
        if (modalRegister) {
          modalRegister.classList.add("show");
          modalRegister.style.display = "flex";
        } else {
          Swal.fire("Error!", "Register modal not found.", "error");
        }
      });
    }
  }

  // Login Modal
  const modalLogin = document.querySelector(".modalLogin");
  const loginForm = document.querySelector(".formLogin");
  const forgotPasswordLink = document.querySelector(".modalLogin .forgot-password");
  const registerLink = document.querySelector(".formLogin a");

  if (modalLogin) {
    modalLogin.addEventListener("click", (e) => {
      if (e.target === modalLogin) {
        modalLogin.classList.remove("show");
        modalLogin.style.display = "none";
      }
    });
  }

  if (loginForm) {
    loginForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value.trim();
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

      if (!emailRegex.test(email)) {
        Swal.fire("Error!", "Please enter a valid email address.", "error");
        return;
      }
      if (!password) {
        Swal.fire("Error!", "Please enter a password.", "error");
        return;
      }

      const accounts = JSON.parse(localStorage.getItem("accounts")) || [];
      const user = accounts.find((account) => account.email === email && account.password === password);

      if (user) {
        localStorage.setItem("currentUser", JSON.stringify(user));
        Swal.fire("Success!", "Logged in successfully.", "success").then(() => {
          modalLogin.classList.remove("show");
          modalLogin.style.display = "none";
          loginForm.reset();
          updateAuthButtons();
          if (user.role === "Admin") {
            window.location.href = "Admin-page.html";
          }
        });
      } else {
        Swal.fire("Error!", "Invalid email or password.", "error");
      }
    });
  }

  if (forgotPasswordLink) {
    forgotPasswordLink.addEventListener("click", (e) => {
      e.preventDefault();
      Swal.fire({
        title: "Forgot Password",
        text: "Please contact support at shadowsgamer371@gmail.com to reset your password.",
        icon: "info",
      });
    });
  }

  if (registerLink) {
    registerLink.addEventListener("click", (e) => {
      e.preventDefault();
      modalLogin.classList.remove("show");
      modalLogin.style.display = "none";
      const modalRegister = document.querySelector(".modalRegister");
      if (modalRegister) {
        modalRegister.classList.add("show");
        modalRegister.style.display = "flex";
      }
    });
  }

  // Register Modal
  const modalRegister = document.querySelector(".modalRegister");
  const registerForm = document.querySelector(".formRegister");
  const loginLink = document.querySelector(".formRegister a");

  if (modalRegister) {
    modalRegister.addEventListener("click", (e) => {
      if (e.target === modalRegister) {
        modalRegister.classList.remove("show");
        modalRegister.style.display = "none";
      }
    });
  }

  if (registerForm) {
    registerForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const name = document.getElementById("name").value.trim();
      const email = document.getElementById("email1").value.trim();
      const password1 = document.getElementById("password1").value.trim();
      const password2 = document.getElementById("password2").value.trim();
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;

      if (!name || !email || !password1 || !password2) {
        Swal.fire("Error!", "Please fill in all fields.", "error");
        return;
      }
      if (!emailRegex.test(email)) {
        Swal.fire("Error!", "Please enter a valid email address.", "error");
        return;
      }
      if (!passwordRegex.test(password1)) {
        Swal.fire(
          "Error!",
          "Password must be at least 8 characters long, include uppercase, lowercase, number, and special character.",
          "error"
        );
        return;
      }
      if (password1 !== password2) {
        Swal.fire("Error!", "Passwords do not match.", "error");
        return;
      }

      const accounts = JSON.parse(localStorage.getItem("accounts")) || [];
      if (accounts.some((account) => account.email === email)) {
        Swal.fire("Error!", "This email is already registered.", "error");
        return;
      }

      const newAccount = {
        accountId: `TK${Math.floor(Math.random() * 1000000).toString().padStart(6, "0")}`,
        fullName: name,
        email,
        password: password1,
        dob: "",
        phone: "",
        hometown: "",
        role: "Users",
      };

      accounts.push(newAccount);
      localStorage.setItem("accounts", JSON.stringify(accounts));
      localStorage.setItem("currentUser", JSON.stringify(newAccount));

      Swal.fire("Success!", "Registered successfully. You are now logged in.", "success").then(() => {
        modalRegister.classList.remove("show");
        modalRegister.style.display = "none";
        registerForm.reset();
        updateAuthButtons();
      });
    });
  }

  if (loginLink) {
    loginLink.addEventListener("click", (e) => {
      e.preventDefault();
      modalRegister.classList.remove("show");
      modalRegister.style.display = "none";
      const modalLogin = document.querySelector(".modalLogin");
      if (modalLogin) {
        modalLogin.classList.add("show");
        modalLogin.style.display = "flex";
      }
    });
  }

  let currentSrc = null;
  let name_music = document.getElementById("name_music");
  let name_artist = document.getElementById("name_artist");
  let img_player = document.getElementById("img_player");
  let start_pause = document.getElementById("start-pause");
  let audio = document.getElementById("audio-player");

  function startstopaudio() {
    if (audio.paused) {
      audio.play();
      start_pause.innerHTML = `<i class="bi bi-pause"></i>`;
    } else {
      audio.pause();
      start_pause.innerHTML = `<i class="bi bi-play-fill"></i>`;
    }
  }

  function nextAudio(itemClass, id) {
    if (itemClass == "Featured-item") {
      let currentIndex = id;
      if (currentIndex <= data.data[0].Featured_Albums.length ) {
        currentIndex++;
        let nextAlbum = data.data[0].Featured_Albums[currentIndex -1];
        playAudio(nextAlbum.mp3, nextAlbum.name_music, nextAlbum.name, nextAlbum.img, nextAlbum.id);
      }
      currentAudio = {
        itemClass: itemClass,
        id: currentIndex,
      };
    }else if (itemClass == "Trending-item") {
      let currentIndex = id;
      if (currentIndex < data.data[1].Trending_Albums.length) {
        currentIndex++;
        let nextAlbum = data.data[1].Trending_Albums[currentIndex -1];
        playAudio(nextAlbum.mp3, nextAlbum.name_music, nextAlbum.name, nextAlbum.img, nextAlbum.id);
      }
      currentAudio = {
        itemClass: itemClass,
        id: currentIndex,
      };
    }else if (itemClass == "Artists-item") {
      let currentIndex = id;
      if (currentIndex < data.data[3].Albums_By_Artists.length) {
        currentIndex++;
        let nextAlbum = data.data[3].Albums_By_Artists[currentIndex -1];
        playAudio(nextAlbum.mp3, nextAlbum.name_music, nextAlbum.name, nextAlbum.img, nextAlbum.id);
      }
      currentAudio = {
        itemClass: itemClass,
        id: currentIndex,
      };
    }else if (itemClass == "trendingItem") {
      let currentIndex = id;
      if (currentIndex < data.data[4].New_Releases.length) {
        currentIndex++;
        let nextAlbum = data.data[4].New_Releases[currentIndex -1];
        playAudio(nextAlbum.mp3, nextAlbum.name_music, nextAlbum.name, nextAlbum.img, nextAlbum.id);
      }
      currentAudio = {
        itemClass: itemClass,
        id: currentIndex,
      };
    }else if (itemClass == "top-item") {
      let currentIndex = id;
      if (currentIndex < data.data[2].top_15_albums.length) {
        currentIndex++;
        let nextAlbum = data.data[2].top_15_albums[currentIndex -1];
        playAudio(nextAlbum.mp3, nextAlbum.name_music, nextAlbum.name, nextAlbum.img, nextAlbum.id);
      }
      currentAudio = {
        itemClass: itemClass,
        id: currentIndex,
      };
    }
  }

  function prevAudio(itemClass, id) {
    if (itemClass == "Featured-item") {
      let currentIndex = id;
      if (currentIndex > 1) {
        currentIndex--;
        let prevAlbum = data.data[0].Featured_Albums[currentIndex -1];
        playAudio(prevAlbum.mp3, prevAlbum.name_music, prevAlbum.name, prevAlbum.img, prevAlbum.id);
      }
      currentAudio = {
        itemClass: itemClass,
        id: currentIndex,
      };
    }else if (itemClass == "Trending-item") {
      let currentIndex = id;
      if (currentIndex > 1) {
        currentIndex--;
        let prevAlbum = data.data[1].Trending_Albums[currentIndex -1];
        playAudio(prevAlbum.mp3, prevAlbum.name_music, prevAlbum.name, prevAlbum.img, prevAlbum.id);
      }
      currentAudio = {
        itemClass: itemClass,
        id: currentIndex,
      };
    }else if (itemClass == "Artists-item") {
      let currentIndex = id;
      if (currentIndex > 1) {
        currentIndex--;
        let prevAlbum = data.data[3].Albums_By_Artists[currentIndex -1];
        playAudio(prevAlbum.mp3, prevAlbum.name_music, prevAlbum.name, prevAlbum.img, prevAlbum.id);
      }
      currentAudio = {
        itemClass: itemClass,
        id: currentIndex,
      };
    }else if (itemClass == "trendingItem") {
      let currentIndex = id;
      if (currentIndex > 1) {
        currentIndex--;
        let prevAlbum = data.data[4].New_Releases[currentIndex -1];
        playAudio(prevAlbum.mp3, prevAlbum.name_music, prevAlbum.name, prevAlbum.img, prevAlbum.id);
      }
      currentAudio = {
        itemClass: itemClass,
        id: currentIndex,
      };
    }else if (itemClass == "top-item") {
      let currentIndex = id;
      if (currentIndex > 1) {
        currentIndex--;
        let prevAlbum = data.data[2].top_15_albums[currentIndex -1];
        playAudio(prevAlbum.mp3, prevAlbum.name_music, prevAlbum.name, prevAlbum.img, prevAlbum.id);
      }
      currentAudio = {
        itemClass: itemClass,
        id: currentIndex,
      };
    }
  }

  let btn_next_audio = document.getElementById("next-audio");
  btn_next_audio.addEventListener("click", function () {  
    nextAudio(currentAudio.itemClass, currentAudio.id);
  });

  let currentAudio = {};
  let btn_prev_audio = document.getElementById("prev-audio");
  btn_prev_audio.addEventListener("click", function () {
    prevAudio(currentAudio.itemClass, currentAudio.id);
  });

  function playAudio(src, name_music1, name_artist1, img, id, itemClass) {
    currentAudio = {
      itemClass: itemClass,
      id: id,
    }
    name_music.innerText = name_music1;
    name_artist.innerText = name_artist1;
    img_player.src = img;
    audio.src = src;
    audio.play();
    start_pause.innerHTML = `<i class="bi bi-pause"></i>`;
  }

  let volume = document.getElementById("volume");
  volume.addEventListener("click", function () {
    if(audio.muted){
      audio.muted = false;
      volume.innerHTML = `<i class="bi bi-volume-up"></i>`;
    }else{
      audio.muted = true;
      volume.innerHTML = `<i class="bi bi-volume-mute"></i>`;
    }
  });

  // Sidebar Toggle
  let sidebar = document.querySelector('.sidebar');
  let chevronBtn = document.querySelector('.sidebar-chevorn a');
  let mainContent = document.querySelector('.container');
  let header = document.querySelector('header');
  let isSidebarExpanded = false;

  chevronBtn.addEventListener('click', () => {
    isSidebarExpanded = !isSidebarExpanded;
    if (isSidebarExpanded) {
      sidebar.classList.add('expanded');
      mainContent.classList.add('expanded');
      header.classList.add('expanded');
      chevronBtn.querySelector('i').classList.replace('fa-chevron-right', 'fa-chevron-left');
    } else {
      sidebar.classList.remove('expanded');
      mainContent.classList.remove('expanded');
      header.classList.remove('expanded');
      chevronBtn.querySelector('i').classList.replace('fa-chevron-left', 'fa-chevron-right');
    }
  });

  let links = document.querySelectorAll('.sidebar a');
  let currentPage = window.location.pathname.split('/').pop();
  links.forEach(link => {
    let linkPage = link.getAttribute('href');
    if (linkPage === currentPage) {
      link.classList.add('active');
    }
  });

  // Initialize header buttons
  updateAuthButtons();
});