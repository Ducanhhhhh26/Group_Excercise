let data = {
  "data": [
    {
      "Featured_Albums": [
        {
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Bloodlust",
          "img": "/assets/album1.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Death%20Bed.mp3"
        },
        {
          "name": "Ava Cornish & Brian Hill",
          "name_music": "Time flies",
          "img": "/assets/album2.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Bad%20Liar.mp3"
        },
        {
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Dark matters",
          "img": "/assets/album3.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Faded.mp3"
        },
        {
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Eye to eye",
          "img": "/assets/album4.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Hate%20Me.mp3"
        },
        {
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Cloud nine",
          "img": "/assets/album5.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Solo.mp3"
        },
        {
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Cobweb of lies",
          "img": "/assets/album6.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Without%20Me.mp3"
        },
        {
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Endless Things",
          "img": "/assets/artist1.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Death%20Bed.mp3"
        },
        {
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Desired Games",
          "img": "/assets/artist2.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Death%20Bed.mp3"
        }
      ]
    },
    {
      "Trending_Albums": [
        {
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Dream Your",
          "img": "/assets/artist13.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Bad%20Liar.mp3"
        },
        {
          "name": "Ava Cornish & Brian Hill",
          "name_music": "Until I Met You",
          "img": "/assets/artist12.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Faded.mp3"
        },
        {
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Gimme Some Courage",
          "img": "/assets/artist11.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Hate%20Me.mp3"
        },
        {
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Dark Alley Acoustic",
          "img": "/assets/artist10.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Hate%20Me.mp3"
        },
        {
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Walking Promises",
          "img": "/assets/artist9.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Death%20Bed.mp3"
        },
        {
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Desired Games",
          "img": "/assets/artist8.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Death%20Bed.mp3"
        },
        {
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Endless Things",
          "img": "/assets/artist7.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Solo.mp3"
        },
        {
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Desired Games",
          "img": "/assets/artist6.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Hate%20Me.mp3"
        }
      ]
    },
    {
      "top_15_albums": [
        {
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Dream Your",
          "img": "/assets/1.png",
          "mp3": "https://samplesongs.netlify.app/Bad%20Liar.mp3"
        },
        {
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Until I Met You",
          "img": "/assets/2.png",
          "mp3": "https://samplesongs.netlify.app/Solo.mp3"
        },
        {
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Gimme Some",
          "img": "/assets/3.png",
          "mp3": "https://samplesongs.netlify.app/Hate%20Me.mp3"
        },
        {
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Dark Alley Acoustic",
          "img": "/assets/4.png",
          "mp3": "https://samplesongs.netlify.app/Without%20Me.mp3"
        },
        {
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Walking Promises",
          "img": "/assets/5.png",
          "mp3": "https://samplesongs.netlify.app/Solo.mp3"
        },
        {
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Desired Games",
          "img": "/assets/6.png",
          "mp3": "https://samplesongs.netlify.app/Faded.mp3"
        },
        {
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Endless Things",
          "img": "/assets/7.png",
          "mp3": "https://samplesongs.netlify.app/Solo.mp3"
        },
        {
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Desired Games",
          "img": "/assets/8.png",
          "mp3": "https://samplesongs.netlify.app/Solo.mp3"
        },
        {
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Desired Games",
          "img": "/assets/9.png",
          "mp3": "https://samplesongs.netlify.app/Solo.mp3"
        },
        {
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Desired Games",
          "img": "/assets/10.png",
          "mp3": "https://samplesongs.netlify.app/Solo.mp3"
        },
        {
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Desired Games",
          "img": "/assets/11.png",
          "mp3": "https://samplesongs.netlify.app/Solo.mp3"
        },
        {
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Desired Games",
          "img": "/assets/12.png",
          "mp3": "https://samplesongs.netlify.app/Solo.mp3"
        },
        {
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Desired Games",
          "img": "/assets/13.png",
          "mp3": "https://samplesongs.netlify.app/Solo.mp3"
        },
        {
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Desired Games",
          "img": "/assets/14.png",
          "mp3": "https://samplesongs.netlify.app/Solo.mp3"
        },
        {
          "name": "Ava Cornish & Brian Hilltest",
          "name_music": "Desired Games",
          "img": "/assets/15.png",
          "mp3": "https://samplesongs.netlify.app/Solo.mp3"
        }
      ]
    },
    {
      "Albums_By_Artists": [
        {
          "name": "Ava Cornish",
          "name_music": "Best Of Ava Cornish",
          "img": "/assets/artist1.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Solo.mp3"
        },
        {
          "name": "Until I Met You",
          "name_music": "Best Of Ava Cornish",
          "img": "/assets/artist2.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Faded.mp3"
        },
        {
          "name": "Gimme Some Courage",
          "name_music": "Best Of Ava Cornish",
          "img": "/assets/artist3.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Hate%20Me.mp3"
        },
        {
          "name": "Dark Alley Acoustic",
          "name_music": "Best Of Ava Cornish",
          "img": "/assets/artist4.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Without%20Me.mp3"
        },
        {
          "name": "Walking Promises",
          "name_music": "Best Of Ava Cornish",
          "img": "/assets/artist5.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Death%20Bed.mp3"
        },
        {
          "name": "Desired Games",
          "name_music": "Best Of Ava Cornish",
          "img": "/assets/artist6.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Solo.mp3"
        },
        {
          "name": "Endless Things",
          "name_music": "Best Of Ava Cornish",
          "img": "/assets/artist7.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Bad%20Liar.mp3"
        },
        {
          "name": "Desired Games",
          "name_music": "Best Of Ava Cornish",
          "img": "/assets/artist8.jpg.png",
          "mp3": "https://samplesongs.netlify.app/Faded.mp3"
        }
      ]
    }
  ]
};

document.addEventListener("DOMContentLoaded", () => {
    // Tải danh sách album từ localStorage hoặc data
    let albums = (() => {
        try {
            const stored = localStorage.getItem("albums");
            return stored ? JSON.parse(stored) : [
                ...data.data[0].Featured_Albums.map(a => ({ ...a, type: "Featured_Albums", id: `FA${Math.floor(Math.random() * 1000000).toString().padStart(6, "0")}` })),
                ...data.data[1].Trending_Albums.map(a => ({ ...a, type: "Trending_Albums", id: `TA${Math.floor(Math.random() * 1000000).toString().padStart(6, "0")}` })),
                ...data.data[2].top_15_albums.map(a => ({ ...a, type: "top_15_albums", id: `T15${Math.floor(Math.random() * 1000000).toString().padStart(6, "0")}` })),
                ...data.data[3].Albums_By_Artists.map(a => ({ ...a, type: "Albums_By_Artists", id: `ABA${Math.floor(Math.random() * 1000000).toString().padStart(6, "0")}` }))
            ];
        } catch (e) {
            console.error("Lỗi khi parse localStorage 'albums':", e);
            return [
                ...data.data[0].Featured_Albums.map(a => ({ ...a, type: "Featured_Albums", id: `FA${Math.floor(Math.random() * 1000000).toString().padStart(6, "0")}` })),
                ...data.data[1].Trending_Albums.map(a => ({ ...a, type: "Trending_Albums", id: `TA${Math.floor(Math.random() * 1000000).toString().padStart(6, "0")}` })),
                ...data.data[2].top_15_albums.map(a => ({ ...a, type: "top_15_albums", id: `T15${Math.floor(Math.random() * 1000000).toString().padStart(6, "0")}` })),
                ...data.data[3].Albums_By_Artists.map(a => ({ ...a, type: "Albums_By_Artists", id: `ABA${Math.floor(Math.random() * 1000000).toString().padStart(6, "0")}` }))
            ];
        }
    })();
    let currentFilter = "all";
    let currentPage = 1;
    const itemsPerPage = 10;
    let searchQuery = "";

    // Chuẩn hóa dữ liệu album
    function normalizeAlbums() {
        const normalized = albums.map((album) => ({
            id: album.id || `${album.type.slice(0, 3).toUpperCase()}${Math.floor(Math.random() * 1000000).toString().padStart(6, "0")}`,
            name_music: album.name_music || "",
            name: album.name || "",
            img: album.img || "",
            mp3: album.mp3 || "",
            type: ["Featured_Albums", "Trending_Albums", "top_15_albums", "Albums_By_Artists"].includes(album.type) ? album.type : "Featured_Albums"
        }));
        try {
            localStorage.setItem("albums", JSON.stringify(normalized));
        } catch (e) {
            console.error("Lỗi khi lưu vào localStorage:", e);
        }
        return normalized;
    }

    // Cập nhật số lượng bộ lọc
    function updateFilterCounts(albums) {
        const filterPills = document.querySelectorAll(".filter-pill");
        if (!filterPills.length) {
            console.error("Không tìm thấy bộ lọc (.filter-pill)!");
            return;
        }
        const counts = {
            all: albums.length,
            Featured_Albums: albums.filter((a) => a.type === "Featured_Albums").length,
            Trending_Albums: albums.filter((a) => a.type === "Trending_Albums").length,
            top_15_albums: albums.filter((a) => a.type === "top_15_albums").length,
            Albums_By_Artists: albums.filter((a) => a.type === "Albums_By_Artists").length
        };
        filterPills.forEach((pill) => {
            const filter = pill.getAttribute("data-filter");
            const countSpan = pill.querySelector(".filter-count");
            if (countSpan) {
                countSpan.textContent = counts[filter] || 0;
            } else {
                console.warn(`Không tìm thấy span .filter-count cho bộ lọc: ${filter}`);
            }
        });
    }

    // Tải và hiển thị album
    function loadAlbums(filter = currentFilter, page = currentPage, query = searchQuery) {
        albums = normalizeAlbums();
        let filteredAlbums = filter === "all" ? albums : albums.filter((a) => a.type === filter);

        if (query) {
            filteredAlbums = filteredAlbums.filter(
                (a) =>
                    a.name_music.toLowerCase().includes(query.toLowerCase()) ||
                    a.name.toLowerCase().includes(query.toLowerCase()) ||
                    a.id.toLowerCase().includes(query.toLowerCase())
            );
        }

        updateFilterCounts(albums);
        const totalItems = filteredAlbums.length;
        const totalPages = Math.ceil(totalItems / itemsPerPage) || 1;
        page = Math.max(1, Math.min(page, totalPages)); // Đảm bảo trang hợp lệ
        currentPage = page;
        const startIndex = (page - 1) * itemsPerPage;
        const paginatedAlbums = filteredAlbums.slice(startIndex, startIndex + itemsPerPage);

        const tbody = document.querySelector("table tbody");
        if (!tbody) {
            console.error("Không tìm thấy phần thân bảng (table tbody)!");
            return;
        }
        tbody.innerHTML = paginatedAlbums.length
            ? paginatedAlbums
                  .map(
                      (album, index) => `
                      <tr>
                          <td><div class="form-check"><input class="form-check-input" type="checkbox" value=""></div></td>
                          <td>${album.id}</td>
                          <td>${album.name_music}</td>
                          <td>${album.name}</td>
                          <td><img src="${album.img}" alt="${album.name_music}" style="width: 50px; height: 50px;"></td>
                          <td><a href="${album.mp3}" target="_blank">Link</a></td>
                          <td><span class="tag">${album.type}</span></td>
                          <td>
                              <div class="d-flex">
                                  <button class="btn btn-sm btn-link text-danger p-0 me-2 delete-btn" data-index="${albums.indexOf(album)}"><i class="bi bi-trash"></i></button>
                                  <button class="btn btn-sm btn-link text-primary p-0 edit-btn" data-index="${albums.indexOf(album)}"><i class="bi bi-pencil"></i></button>
                              </div>
                          </td>
                      </tr>
                  `
                  )
                  .join("")
            : '<tr><td colspan="8" class="text-center">Không tìm thấy album.</td></tr>';

        updatePagination(totalPages, page);
        attachButtonListeners();
    }

    // Cập nhật phân trang
    function updatePagination(totalPages, currentPage) {
        const paginationContainer = document.querySelector(".pagination");
        if (!paginationContainer) {
            console.error("Không tìm thấy container phân trang (.pagination)!");
            return;
        }
        paginationContainer.innerHTML = "";

        const prevItem = document.createElement("li");
        prevItem.className = `page-item ${currentPage === 1 ? "disabled" : ""}`;
        prevItem.innerHTML = `<a class="page-link" href="#">Trước</a>`;
        prevItem.addEventListener("click", (e) => {
            e.preventDefault();
            if (currentPage > 1) {
                currentPage--;

                loadAlbums();
            }
        });
        paginationContainer.appendChild(prevItem);

        for (let i = 1; i <= totalPages; i++) {
            const pageItem = document.createElement("li");
            pageItem.className = `page-item ${i === currentPage ? "active" : ""}`;
            pageItem.innerHTML = `<a class="page-link" href="#">${i}</a>`;
            pageItem.addEventListener("click", (e) => {
                e.preventDefault();
                currentPage = i;

                loadAlbums();
            });
            paginationContainer.appendChild(pageItem);
        }

        const nextItem = document.createElement("li");
        nextItem.className = `page-item ${currentPage === totalPages ? "disabled" : ""}`;
        nextItem.innerHTML = `<a class="page-link" href="#">Tiếp</a>`;
        nextItem.addEventListener("click", (e) => {
            e.preventDefault();
            if (currentPage < totalPages) {
                currentPage++;

                loadAlbums();
            }
        });
        paginationContainer.appendChild(nextItem);
    }

    // Gắn sự kiện cho các nút
    function attachButtonListeners() {
        const deleteButtons = document.querySelectorAll(".delete-btn");
        const editButtons = document.querySelectorAll(".edit-btn");
        deleteButtons.forEach((btn) => {
            btn.removeEventListener("click", handleDelete);
            btn.addEventListener("click", handleDelete);
        });
        editButtons.forEach((btn) => {
            btn.removeEventListener("click", handleEdit);
            btn.addEventListener("click", handleEdit);
        });
    }

    // Xử lý thêm album
    const addButton = document.querySelector(".btn-primary");
    if (addButton) {
        addButton.addEventListener("click", () => {
            Swal.fire({
                title: "<strong>Thêm Album</strong>",
                html: `
                    <div class="container" style="text-align: left; font-family: Arial, sans-serif;">
                        <div class="row mb-2">
                            <div class="col-12">
                                <h6 style="color: #333; font-size: 14px; font-weight: bold;">Thông tin Album</h6>
                                <p style="color: #666; font-size: 12px;">Thêm thông tin album mới</p>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-12 text-center">
                                <div class="d-flex justify-content-center align-items-center" style="height: 80px; width: 80px; border-radius: 50%; background-color: #e0e0e0; margin: 0 auto;">
                                    <span style="color: #666; font-size: 12px; text-align: center;">Nhấn để tải lên</span>
                                </div>
                                <p style="color: #666; font-size: 10px; margin-top: 5px;">SVG, PNG, JPG hoặc GIF (tối đa 400x400px)</p>
                                <input type="file" id="album-img" accept="image/*" style="display: none;" />
                            </div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-6">
                                <label class="form-label" style="color: #333; font-size: 12px;">Tên Album</label>
                                <div class="input-group">
                                    <span class="input-group-text" style="background-color: #fff; border-right: none; border-color: #ccc;">
                                        <i class="bi bi-music-note-list" style="color: #666;"></i>
                                    </span>
                                    <input type="text" class="form-control" id="name_music" placeholder="Tên Album" style="font-size: 12px; border-left: none; border-color: #ccc;" />
                                </div>
                            </div>
                            <div class="col-6">
                                <label class="form-label" style="color: #333; font-size: 12px;">Nghệ sĩ</label>
                                <div class="input-group">
                                    <span class="input-group-text" style="background-color: #fff; border-right: none; border-color: #ccc;">
                                        <i class="bi bi-person-fill" style="color: #666;"></i>
                                    </span>
                                    <input type="text" class="form-control" id="name" placeholder="Tên Nghệ sĩ" style="font-size: 12px; border-left: none; border-color: #ccc;" />
                                </div>
                            </div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-6">
                                <label class="form-label" style="color: #333; font-size: 12px;">URL Hình ảnh</label>
                                <div class="input-group">
                                    <span class="input-group-text" style="background-color: #fff; border-right: none; border-color: #ccc;">
                                        <i class="bi bi-image" style="color: #666;"></i>
                                    </span>
                                    <input type="text" class="form-control" id="img" placeholder="URL Hình ảnh" style="font-size: 12px; border-left: none; border-color: #ccc;" />
                                </div>
                            </div>
                            <div class="col-6">
                                <label class="form-label" style="color: #333; font-size: 12px;">URL MP3</label>
                                <div class="input-group">
                                    <span class="input-group-text" style="background-color: #fff; border-right: none; border-color: #ccc;">
                                        <i class="bi bi-music-note" style="color: #666;"></i>
                                    </span>
                                    <input type="text" class="form-control" id="mp3" placeholder="URL MP3" style="font-size: 12px; border-left: none; border-color: #ccc;" />
                                </div>
                            </div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-6">
                                <label class="form-label" style="color: #333; font-size: 12px;">Loại</label>
                                <select class="form-select" id="type" style="font-size: 12px; border-color: #ccc;">
                                    <option value="Featured_Albums">Nổi bật</option>
                                    <option value="Trending_Albums">Xu hướng</option>
                                    <option value="top_15_albums">Top 15</option>
                                    <option value="Albums_By_Artists">Theo Nghệ sĩ</option>
                                </select>
                            </div>
                        </div>
                    </div>
                `,
                showCloseButton: true,
                showCancelButton: true,
                focusConfirm: false,
                confirmButtonText: "Thêm Album",
                cancelButtonText: "Hủy",
                customClass: { popup: "custom-modal", confirmButton: "btn btn-primary", cancelButton: "btn btn-gray me-2" },
                didOpen: () => {
                    const uploadArea = document.querySelector(".d-flex.justify-content-center.align-items-center");
                    if (uploadArea) {
                        const fileInput = document.getElementById("album-img");
                        uploadArea.addEventListener("click", () => fileInput.click());
                    } else {
                        console.warn("Không tìm thấy khu vực tải lên trong modal!");
                    }
                },
                preConfirm: () => {
                    const name_music = document.getElementById("name_music").value.trim();
                    const name = document.getElementById("name").value.trim();
                    const img = document.getElementById("img").value.trim();
                    const mp3 = document.getElementById("mp3").value.trim();
                    const type = document.getElementById("type").value;

                    if (!name_music || !name || !img || !mp3) {
                        Swal.showValidationMessage("Tất cả các trường đều bắt buộc.");
                        return false;
                    }
                    const urlRegex = /^(https?:\/\/[^\s$.?#].[^\s]*)$/;
                    if (!urlRegex.test(img) || !urlRegex.test(mp3)) {
                        Swal.showValidationMessage("Vui lòng nhập URL hợp lệ cho Hình ảnh và MP3.");
                        return false;
                    }

                    return { name_music, name, img, mp3, type };
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    albums.push({
                        id: `${result.value.type.slice(0, 3).toUpperCase()}${Math.floor(Math.random() * 1000000).toString().padStart(6, "0")}`,
                        name_music: result.value.name_music,
                        name: result.value.name,
                        img: result.value.img,
                        mp3: result.value.mp3,
                        type: result.value.type
                    });
                    localStorage.setItem("albums", JSON.stringify(albums));
                    currentPage = 1;
                    loadAlbums();
                    Swal.fire("Thành công!", "Đã thêm album thành công.", "success");
                }
            });
        });
    } else {
        console.error("Không tìm thấy nút Thêm Album (.btn-primary)!");
    }

    // Xử lý xóa album
    function handleDelete(event) {
        const index = event.currentTarget.getAttribute("data-index");
        const album = albums[index];

        Swal.fire({
            title: "<strong>Xác nhận Xóa</strong>",
            html: `<p style="color: #333; font-size: 14px;">Bạn có chắc muốn xóa album <strong>${album.name_music}</strong>?</p>`,
            showCloseButton: true,
            showCancelButton: true,
            focusConfirm: false,
            confirmButtonText: "Xóa",
            cancelButtonText: "Hủy",
            customClass: { popup: "custom-modal", confirmButton: "btn btn-danger", cancelButton: "btn btn-gray me-2" }
        }).then((result) => {
            if (result.isConfirmed) {
                albums.splice(index, 1);
                localStorage.setItem("albums", JSON.stringify(albums));
                currentPage = 1;
                loadAlbums();
                Swal.fire("Thành công!", "Đã xóa album thành công.", "success");
            }
        });
    }

    // Xử lý chỉnh sửa album
    function handleEdit(event) {
        const index = event.currentTarget.getAttribute("data-index");
        const album = albums[index];

        Swal.fire({
            title: "<strong>Chỉnh sửa Album</strong>",
            html: `
                <div class="container" style="text-align: left; font-family: Arial, sans-serif;">
                    <div class="row mb-2">
                        <div class="col-12">
                            <h6 style="color: #333; font-size: 14px; font-weight: bold;">Thông tin Album</h6>
                            <p style="color: #666; font-size: 12px;">Cập nhật thông tin album</p>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-12 text-center">
                            <div class="d-flex justify-content-center align-items-center" style="height: 80px; width: 80px; border-radius: 50%; background-color: #e0e0e0; margin: 0 auto;">
                                <span style="color: #666; font-size: 12px; text-align: center;">Nhấn để tải lên</span>
                            </div>
                            <p style="color: #666; font-size: 10px; margin-top: 5px;">SVG, PNG, JPG hoặc GIF (tối đa 400x400px)</p>
                            <input type="file" id="album-img" accept="image/*" style="display: none;" />
                        </div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-6">
                            <label class="form-label" style="color: #333; font-size: 12px;">Tên Album</label>
                            <div class="input-group">
                                <span class="input-group-text" style="background-color: #fff; border-right: none; border-color: #ccc;">
                                    <i class="bi bi-music-note-list" style="color: #666;"></i>
                                </span>
                                <input type="text" class="form-control" id="name_music" value="${album.name_music}" style="font-size: 12px; border-left: none; border-color: #ccc;" />
                            </div>
                        </div>
                        <div class="col-6">
                            <label class="form-label" style="color: #333; font-size: 12px;">Nghệ sĩ</label>
                            <div class="input-group">
                                <span class="input-group-text" style="background-color: #fff; border-right: none; border-color: #ccc;">
                                    <i class="bi bi-person-fill" style="color: #666;"></i>
                                </span>
                                <input type="text" class="form-control" id="name" value="${album.name}" style="font-size: 12px; border-left: none; border-color: #ccc;" />
                            </div>
                        </div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-6">
                            <label class="form-label" style="color: #333; font-size: 12px;">URL Hình ảnh</label>
                            <div class="input-group">
                                <span class="input-group-text" style="background-color: #fff; border-right: none; border-color: #ccc;">
                                    <i class="bi bi-image" style="color: #666;"></i>
                                </span>
                                <input type="text" class="form-control" id="img" value="${album.img}" style="font-size: 12px; border-left: none; border-color: #ccc;" />
                            </div>
                        </div>
                        <div class="col-6">
                            <label class="form-label" style="color: #333; font-size: 12px;">URL MP3</label>
                            <div class="input-group">
                                <span class="input-group-text" style="background-color: #fff; border-right: none; border-color: #ccc;">
                                    <i class="bi bi-music-note" style="color: #666;"></i>
                                </span>
                                <input type="text" class="form-control" id="mp3" value="${album.mp3}" style="font-size: 12px; border-left: none; border-color: #ccc;" />
                            </div>
                        </div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-6">
                            <label class="form-label" style="color: #333; font-size: 12px;">Loại</label>
                            <select class="form-select" id="type" style="font-size: 12px; border-color: #ccc;">
                                <option value="Featured_Albums" ${album.type === "Featured_Albums" ? "selected" : ""}>Nổi bật</option>
                                <option value="Trending_Albums" ${album.type === "Trending_Albums" ? "selected" : ""}>Xu hướng</option>
                                <option value="top_15_albums" ${album.type === "top_15_albums" ? "selected" : ""}>Top 15</option>
                                <option value="Albums_By_Artists" ${album.type === "Albums_By_Artists" ? "selected" : ""}>Theo Nghệ sĩ</option>
                            </select>
                        </div>
                    </div>
                </div>
            `,
            showCloseButton: true,
            showCancelButton: true,
            focusConfirm: false,
            confirmButtonText: "Lưu",
            cancelButtonText: "Hủy",
            customClass: { popup: "custom-modal", confirmButton: "btn btn-primary", cancelButton: "btn btn-gray me-2" },
            didOpen: () => {
                const uploadArea = document.querySelector(".d-flex.justify-content-center.align-items-center");
                if (uploadArea) {
                    const fileInput = document.getElementById("album-img");
                    uploadArea.addEventListener("click", () => fileInput.click());
                } else {
                    console.warn("Không tìm thấy khu vực tải lên trong modal!");
                }
            },
            preConfirm: () => {
                const name_music = document.getElementById("name_music").value.trim();
                const name = document.getElementById("name").value.trim();
                const img = document.getElementById("img").value.trim();
                const mp3 = document.getElementById("mp3").value.trim();
                const type = document.getElementById("type").value;

                if (!name_music || !name || !img || !mp3) {
                    Swal.showValidationMessage("Tất cả các trường đều bắt buộc.");
                    return false;
                }
                const urlRegex = /^(https?:\/\/[^\s$.?#].[^\s]*)$/;
                if (!urlRegex.test(img) || !urlRegex.test(mp3)) {
                    Swal.showValidationMessage("Vui lòng nhập URL hợp lệ cho Hình ảnh và MP3.");
                    return false;
                }

                return { name_music, name, img, mp3, type };
            }
        }).then((result) => {
            if (result.isConfirmed) {
                albums[index] = {
                    id: album.id,
                    name_music: result.value.name_music,
                    name: result.value.name,
                    img: result.value.img,
                    mp3: result.value.mp3,
                    type: result.value.type
                };
                localStorage.setItem("albums", JSON.stringify(albums));
                loadAlbums();
                Swal.fire("Thành công!", "Đã cập nhật album thành công.", "success");
            }
        });
    }

    // Bộ lọc và tìm kiếm
    const filterPills = document.querySelectorAll(".filter-pill");
    if (filterPills.length) {
        filterPills.forEach((pill) => {
            pill.addEventListener("click", () => {
                filterPills.forEach((p) => p.classList.remove("active"));
                pill.classList.add("active");
                currentFilter = pill.getAttribute("data-filter");
                currentPage = 1;

                loadAlbums();
            });
        });
    } else {
        console.error("Không tìm thấy bộ lọc (.filter-pill)!");
    }

    const searchInput = document.querySelector(".form-control[placeholder='Tìm kiếm']");
    if (searchInput) {
        searchInput.addEventListener("input", (e) => {
            searchQuery = e.target.value.trim();
            currentPage = 1;

            loadAlbums();
        });
    } else {
        console.error("Không tìm thấy ô tìm kiếm (.form-control[placeholder='Tìm kiếm'])!");
    }

    // Đăng xuất
    const logoutBtn = document.querySelector(".logout-btn");
    if (logoutBtn) {
        logoutBtn.addEventListener("click", () => {
            localStorage.removeItem("currentUser");
            Swal.fire("Thành công", "Đã đăng xuất thành công.", "success").then(() => {
                window.location.href = "index.html";
            });
        });
    } else {
        console.error("Không tìm thấy nút Đăng xuất (.logout-btn)!");
    }

    // Xóa các album đã chọn
    const deleteSelectedBtn = document.querySelector(".delete-selected-btn");
    if (deleteSelectedBtn) {
        deleteSelectedBtn.addEventListener("click", () => {
            const checkboxes = document.querySelectorAll("tbody .form-check-input:checked");
            if (checkboxes.length === 0) {
                Swal.fire("Cảnh báo", "Vui lòng chọn ít nhất một album.", "warning");
                return;
            }

            Swal.fire({
                title: "Xác nhận Xóa",
                text: `Bạn có chắc muốn xóa ${checkboxes.length} album đã chọn?`,
                showCancelButton: true,
                confirmButtonText: "Xóa",
                cancelButtonText: "Hủy",
                customClass: { popup: "custom-modal", confirmButton: "btn btn-danger", cancelButton: "btn btn-gray me-2" }
            }).then((result) => {
                if (result.isConfirmed) {
                    const indices = Array.from(checkboxes)
                        .map((cb) => {
                            const deleteBtn = cb.closest("tr").querySelector(".delete-btn");
                            return deleteBtn ? parseInt(deleteBtn.getAttribute("data-index")) : null;
                        })
                        .filter((index) => index !== null);

                    if (indices.length === 0) {
                        Swal.fire("Lỗi", "Không có album hợp lệ được chọn để xóa.", "error");
                        return;
                    }

                    albums = albums.filter((_, i) => !indices.includes(i));
                    localStorage.setItem("albums", JSON.stringify(albums));
                    currentPage = 1;
                    loadAlbums();
                    Swal.fire("Thành công", "Đã xóa các album được chọn.", "success");
                }
            });
        });
    } else {
        console.error("Không tìm thấy nút Xóa đã chọn (.delete-selected-btn)!");
    }

    // Chọn tất cả
    const selectAllCheckbox = document.getElementById("selectAll");
    if (selectAllCheckbox) {
        selectAllCheckbox.addEventListener("change", (e) => {
            const checkboxes = document.querySelectorAll("tbody .form-check-input");
            checkboxes.forEach((cb) => (cb.checked = e.target.checked));
        });
    } else {
        console.error("Không tìm thấy checkbox Chọn tất cả (#selectAll)!");
    }

    // Tải ban đầu
    loadAlbums();
});